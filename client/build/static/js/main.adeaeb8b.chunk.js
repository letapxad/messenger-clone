(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{148:function(e,t,n){},208:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(10),o=n.n(s),c=(n(148),n(251)),i=n(50),u=n(13),l=n(81),d=n(121),p=n.n(d),h=n(122),b=n(27),j="GET_USER",f="SET_FETCHING_STATUS",m=function(e){return{type:j,user:e}},g=function(e){return{type:f,isFetching:e}},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFetching:!0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return t.user;case f:return Object(b.a)(Object(b.a)({},e),{},{isFetching:t.isFetching});default:return e}},O=n(80),v=function(e,t){var n=t.message,r=t.sender;if(null!==r){var a={id:n.conversationId,otherUser:r,messages:[n]};return a.latestMessageText=n.text,a.unreadCount+=1,[a].concat(Object(O.a)(e))}return e.map((function(e){if(e.id===n.conversationId){var t=Object(b.a)({},e);return t.messages.push(n),t.latestMessageText=n.text,n.senderId===t.otherUser.id&&(t.unreadCount+=1),t}return e}))},C=function(e,t){return e.map((function(e){if(e.otherUser.id===t){var n=Object(b.a)({},e);return n.otherUser.online=!0,n}return e}))},w=function(e,t){return e.map((function(e){if(e.otherUser.id===t){var n=Object(b.a)({},e);return n.otherUser.online=!1,n}return e}))},y=function(e,t){var n={};e.forEach((function(e){n[e.otherUser.id]=!0}));var r=Object(O.a)(e);return t.forEach((function(e){if(!n[e.id]){var t={otherUser:e,messages:[]};r.push(t)}})),r},S=function(e,t){var n=t.conversationId;return e.map((function(e){if(e.id===n){var t=Object(b.a)({},e);return t.unreadCount=0,t}return e}))},k=function(e,t,n){return e.map((function(e){if(e.otherUser.id===t){var r=Object(b.a)({},e);return r.id=n.conversationId,r.messages.push(n),r.latestMessageText=n.text,r}return e}))},F=function(e){return e.forEach((function(e){e.unreadCount=e.messages.filter((function(t){return!1===t.read&&t.senderId===e.otherUser.id})).length;for(var t=e.messages.length-1;t>=0;t--)if(!0===e.messages[t].read&&e.messages[t].senderId!==e.otherUser.id){e.messages[t].isLastRead=!0;break}})),e},I=function(e,t){var n=t.conversationId,r=t.lastReadMessage;return e.map((function(e){if(e.id===n){var t=Object(b.a)(Object(b.a)({},e),{},{messages:Object(O.a)(e.messages)});return t.messages.forEach((function(e){e.read=!0,r&&e.id===r.id?e.isLastRead=!0:e.isLastRead=!1})),t}return e}))},E="GET_CONVERSATIONS",N="SET_MESSAGE",U="ADD_ONLINE_USER",A="REMOVE_OFFLINE_USER",R="SET_SEARCHED_USERS",T="CLEAR_SEARCHED_USERS",L="ADD_CONVERSATION",D="READ_MESSAGES",M="UPDATE_LAST_READ",z=function(e,t){return{type:N,payload:{message:e,sender:t||null}}},W=function(e){return{type:D,payload:{conversationId:e.conversationId}}},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return F(t.conversations);case N:return v(e,t.payload);case U:return C(e,t.id);case A:return w(e,t.id);case R:return y(e,t.users);case T:return e.filter((function(e){return e.id}));case D:return S(e,t.payload);case M:return I(e,t.payload);case L:return k(e,t.payload.recipientId,t.payload.newMessage);default:return e}},P="SET_ACTIVE_CHAT",_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return t.username;default:return e}},G="CLEAR_ON_LOGOUT",q=Object(l.b)({user:x,conversations:B,activeConversation:_}),H=Object(l.c)((function(e,t){return t.type===G&&(e=void 0),q(e,t)}),Object(l.a)(h.a,p.a)),Z=n(131),V=Object(Z.a)({typography:{fontFamily:"Open Sans, sans-serif",fontSize:14,button:{textTransform:"none",letterSpacing:0,fontWeight:"bold"},prompt:{fontSize:22}},overrides:{MuiInput:{input:{fontWeight:"bold"}}},palette:{primary:{main:"#3A8DFF"},secondary:{main:"#B0B0B0"},background:{main:"#FFFFFF"},subText:{main:"#A5A5A5"}}}),J=n(40),$=n(17),K=n(7),Q=n.n(K),X=n(12),Y=n(41),ee=n.n(Y),te=n(126),ne=n.n(te)()(window.location.origin);ne.on("connect",(function(){console.log("connected to server"),H.getState().user.id&&(ne.on("add-online-user",(function(e){H.dispatch(function(e){return{type:U,id:e}}(e))})),ne.on("remove-offline-user",(function(e){H.dispatch(function(e){return{type:A,id:e}}(e))})),ne.on("new-message",(function(e){H.dispatch(z(e.message,e.sender))})),ne.on("message-read",(function(e){var t,n,r;H.dispatch((t=e.conversationId,n=e.lastReadMessage,r=e.recipientId,{type:M,payload:{conversationId:t,lastReadMessage:n,recipientId:r}}))})))}));var re=ne,ae=function(){var e=Object(X.a)(Q.a.mark((function e(t){var n,r;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee.a.post("/api/messages",t);case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=function(e,t){re.emit("new-message",{message:e.message,recipientId:t.recipientId,sender:e.sender})},oe=function(e){re.emit("message-read",{conversationId:e.conversationId,lastReadMessage:e.lastReadMessage,recipientId:e.recipientId})},ce=n(49),ie=n(2),ue=function(){return Object(ie.jsx)("svg",{width:"67px",height:"67px",viewBox:"0 0 67 67",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:Object(ie.jsxs)("g",{id:"chat",children:[Object(ie.jsx)("path",{d:"M57.1688 9.66977C50.8366 3.43256 42.4361 0 33.4832 0C24.5302 0 16.1298 3.43256 9.79755 9.66977C-2.44191 21.7256 -3.29187 41.0233 7.68681 54.0419C6.61019 56.1767 4.88194 58.6605 2.31788 59.9023C1.08544 60.5023 0.391302 61.8 0.603792 63.1395C0.816283 64.4791 1.86457 65.5256 3.22451 65.7349C3.86198 65.8326 4.76861 65.9302 5.87356 65.9302C8.83426 65.9302 13.1974 65.2465 17.6597 62.0791C22.632 64.7163 28.0717 66 33.469 66C42.1386 66 50.7232 62.693 57.1829 56.3302C63.5152 50.093 67 41.8186 67 33C67 24.1814 63.501 15.907 57.1688 9.66977ZM54.4631 53.6651C44.901 63.0837 30.0975 64.9535 18.453 58.214C17.688 57.7674 16.7389 57.907 16.1298 58.507C16.0731 58.5349 16.0164 58.5767 15.9739 58.6186C12.1349 61.5488 8.36678 62.1628 5.87356 62.1628L5.85939 62.1628C8.7351 60.0977 10.5483 57.0279 11.6108 54.6419C11.7808 54.2372 11.8091 53.8186 11.71 53.4279C11.6675 53.0512 11.5116 52.6744 11.2425 52.3674C0.872947 40.8279 1.41126 23.2465 12.4891 12.3349C24.0627 0.934884 42.8894 0.934884 54.4489 12.3349C66.0367 23.7349 66.0367 42.2651 54.4631 53.6651Z",transform:"translate(0 0.5)",id:"Shape",fill:"#FFFFFF",stroke:"none"}),Object(ie.jsx)("path",{d:"M2.5 5C3.88071 5 5 3.88071 5 2.5C5 1.11929 3.88071 0 2.5 0C1.11929 0 0 1.11929 0 2.5C0 3.88071 1.11929 5 2.5 5Z",transform:"translate(31 31.5)",id:"Oval",fill:"#FFFFFF",stroke:"none"}),Object(ie.jsx)("path",{d:"M2.5 5C3.88071 5 5 3.88071 5 2.5C5 1.11929 3.88071 0 2.5 0C1.11929 0 0 1.11929 0 2.5C0 3.88071 1.11929 5 2.5 5Z",transform:"translate(43 31.5)",id:"Oval",fill:"#FFFFFF",stroke:"none"}),Object(ie.jsx)("path",{d:"M2.5 5C3.88071 5 5 3.88071 5 2.5C5 1.11929 3.88071 0 2.5 0C1.11929 0 0 1.11929 0 2.5C0 3.88071 1.11929 5 2.5 5Z",transform:"translate(19 31.5)",id:"Oval",fill:"#FFFFFF",stroke:"none"})]})})},le=n(239),de=n(241),pe=n(243),he=n(211),be=n(252),je=n(244),fe=n(245),me=n(253),ge=n(247),xe=Object(le.a)((function(e){var t;return{root:{flexGrow:1,flexDirection:"column",justifyContent:"center"},paper:Object(ce.a)({margin:"5% auto auto auto",maxWidth:"900px"},e.breakpoints.between("xs","sm"),{margin:"0%"}),image:Object(ce.a)({backgroundImage:'linear-gradient(to bottom, rgba(58, 141, 255, 0.6), rgba(134, 185, 255, 1)), url("/images/bg-img.png")',backgroundSize:"cover",backgroundRepeat:"no-repeat",minHeight:"700px",minWidth:"300px",width:"auto",opacity:"85%"},e.breakpoints.between("xs","sm"),{minHeight:"15px",minWidth:"100%",padding:"5%"}),headline:Object(ce.a)({padding:e.spacing(3)},e.breakpoints.between("xs","sm"),{padding:e.spacing(1)}),form:(t={padding:e.spacing(3),margin:"0 5% 0 5%"},Object(ce.a)(t,e.breakpoints.between("sm","md"),{margin:"0 15% 0 15%"}),Object(ce.a)(t,e.breakpoints.up("lg"),{margin:"0 12% 0 12%"}),t),btn:{width:"150px",height:"45px",fontSize:e.typography.fontSize},btnChangeForm:{color:e.palette.primary.main,backgroundColor:e.palette.background.main},subText:{fontSize:e.typography.fontSize,color:e.palette.subText.main},welcomeMessage:{fontSize:e.typography.prompt.fontSize,fontWeight:"bold"},tagLine:{color:e.palette.background.main,fontSize:e.typography.prompt.fontSize,fontWeight:"light"},bubble:{textAlign:"center"}}})),Oe=function(e){var t=Object($.g)(),n=xe(),r=e.isLoginForm,a=e.handleAction,s=e.formErrorMessage;return Object(ie.jsx)("div",{className:n.root,children:Object(ie.jsx)(de.a,{className:n.paper,children:Object(ie.jsxs)(pe.a,{container:!0,children:[Object(ie.jsxs)(pe.a,{item:!0,container:!0,md:5,className:n.image,justify:"center",alignItems:"center",alignContent:"center",children:[Object(ie.jsx)(pe.a,{item:!0,xs:12,className:n.bubble,children:Object(ie.jsx)(ue,{})}),Object(ie.jsx)(pe.a,{item:!0,children:Object(ie.jsx)(he.a,{className:n.tagLine,children:"Converse with anyone"})}),Object(ie.jsx)(pe.a,{item:!0,children:Object(ie.jsx)(he.a,{className:n.tagLine,children:"with any language"})})]}),Object(ie.jsxs)(pe.a,{item:!0,md:7,xs:12,children:[Object(ie.jsxs)(pe.a,{container:!0,item:!0,xs:12,justify:"flex-end",alignItems:"center",className:n.headline,children:[r&&Object(ie.jsx)(he.a,{className:n.subText,children:"Already have an account?"}),!r&&Object(ie.jsx)(he.a,{className:n.subText,children:"Don't have an account?"}),Object(ie.jsx)(be.a,{mr:3}),r&&Object(ie.jsx)(je.a,{onClick:function(){return t.push("/register")},variant:"contained",size:"large",className:"".concat(n.btnChangeForm," ").concat(n.btn),children:"Create account"}),!r&&Object(ie.jsx)(je.a,{onClick:function(){return t.push("/login")},variant:"contained",size:"large",className:"".concat(n.btnChangeForm," ").concat(n.btn),children:"Login"})]}),Object(ie.jsx)(pe.a,{className:n.form,children:Object(ie.jsx)("form",{onSubmit:a,children:Object(ie.jsxs)(pe.a,{container:!0,spacing:3,children:[Object(ie.jsxs)(pe.a,{item:!0,xs:12,children:[r&&Object(ie.jsx)(he.a,{className:n.welcomeMessage,children:"Welcome back!"}),!r&&Object(ie.jsx)(he.a,{className:n.welcomeMessage,children:"Create an account."})]}),Object(ie.jsx)(pe.a,{item:!0,xs:12,children:Object(ie.jsx)(fe.a,{fullWidth:!0,margin:"normal",required:!0,children:Object(ie.jsx)(me.a,{"aria-label":"username",label:"Username",name:"username",type:"text",required:!0})})}),r&&Object(ie.jsx)(pe.a,{item:!0,xs:12,children:Object(ie.jsx)(fe.a,{fullWidth:!0,margin:"normal",required:!0,children:Object(ie.jsx)(me.a,{required:!0,label:"Password","aria-label":"password",type:"password",name:"password"})})}),!r&&Object(ie.jsx)(pe.a,{item:!0,xs:12,children:Object(ie.jsx)(fe.a,{fullWidth:!0,margin:"normal",required:!0,children:Object(ie.jsx)(me.a,{label:"E-mail address","aria-label":"e-mail address",type:"email",name:"email",required:!0})})}),!r&&Object(ie.jsx)(pe.a,{item:!0,xs:12,children:Object(ie.jsxs)(fe.a,{error:!!s.confirmPassword,fullWidth:!0,margin:"normal",required:!0,children:[Object(ie.jsx)(me.a,{"aria-label":"password",label:"Password",type:"password",inputProps:{minLength:6},name:"password",required:!0}),Object(ie.jsx)(ge.a,{children:s.confirmPassword})]})}),!r&&Object(ie.jsx)(pe.a,{item:!0,xs:12,children:Object(ie.jsxs)(fe.a,{error:!!s.confirmPassword,fullWidth:!0,margin:"normal",required:!0,children:[Object(ie.jsx)(me.a,{label:"Confirm Password","aria-label":"confirm password",type:"password",inputProps:{minLength:6},name:"confirmPassword",required:!0}),Object(ie.jsx)(ge.a,{children:s.confirmPassword})]})}),Object(ie.jsxs)(pe.a,{item:!0,container:!0,xs:12,justify:"center",children:[r&&Object(ie.jsx)(je.a,{type:"submit",variant:"contained",size:"large",color:"primary",className:n.btn,children:"Login"}),!r&&Object(ie.jsx)(je.a,{type:"submit",variant:"contained",size:"large",color:"primary",className:n.btn,children:"Create"})]})]})})})]})]})})})},ve=Object(u.b)((function(e){return{user:e.user}}),(function(e){return{register:function(t){e(function(e){return function(){var t=Object(X.a)(Q.a.mark((function t(n){var r,a;return Q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ee.a.post("/auth/register",e);case 3:r=t.sent,a=r.data,n(m(a)),re.emit("go-online",a.id),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0),n(m({error:t.t0.response.data.error||"Server Error"}));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}()}(t))}}}))((function(e){var t=e.user,n=e.register,a=Object(r.useState)({}),s=Object(J.a)(a,2),o=s[0],c=s[1],i=function(){var e=Object(X.a)(Q.a.mark((function e(t){var r,a,s,o;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),r=t.target.username.value,a=t.target.email.value,s=t.target.password.value,o=t.target.confirmPassword.value,s===o){e.next=8;break}return c({confirmPassword:"Passwords must match"}),e.abrupt("return");case 8:return e.next=10,n({username:r,email:a,password:s});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return t.id?Object(ie.jsx)($.a,{to:"/home"}):Object(ie.jsx)("div",{children:Object(ie.jsx)(Oe,{isLoginForm:!1,handleAction:i,formErrorMessage:o})})})),Ce=Object(u.b)((function(e){return{user:e.user}}),(function(e){return{login:function(t){e(function(e){return function(){var t=Object(X.a)(Q.a.mark((function t(n){var r,a;return Q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ee.a.post("/auth/login",e);case 3:r=t.sent,a=r.data,n(m(a)),re.emit("go-online",a.id),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0),n(m({error:t.t0.response.data.error||"Server Error"}));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}()}(t))}}}))((function(e){var t=e.user,n=e.login,r=function(){var e=Object(X.a)(Q.a.mark((function e(t){var r,a;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),r=t.target.username.value,a=t.target.password.value,e.next=5,n({username:r,password:a});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return t.id?Object(ie.jsx)($.a,{to:"/home"}):Object(ie.jsx)("div",{children:Object(ie.jsx)(Oe,{isLoginForm:!0,handleAction:r})})})),we=n(45),ye=n(46),Se=n(48),ke=n(47),Fe=n(5),Ie=n(250),Ee=Object(le.a)((function(e){return{root:{display:"flex",flexDirection:"column",justifyContent:"space-between",marginLeft:20,flexGrow:1,alignContent:"space-around"},username:{fontWeight:"bold",letterSpacing:-.2},previewText:{fontSize:12,color:"#9CADC8",letterSpacing:-.17},boldPreviewText:{fontSize:12,color:"#000000",letterSpacing:-.17,fontWeight:"bolder"},notification:{height:20,width:20,backgroundColor:"#3F92FF",marginRight:10,color:"white",fontSize:10,letterSpacing:-.5,fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:10},content:{display:"flex",alignItems:"center",justifyContent:"space-between"}}})),Ne=function(e){var t=Ee(),n=e.conversation,r=n.latestMessageText,a=n.otherUser,s=n.unreadCount;return Object(ie.jsx)(be.a,{className:t.root,children:Object(ie.jsxs)(be.a,{children:[Object(ie.jsx)(he.a,{className:t.username,children:a.username}),Object(ie.jsxs)(be.a,{className:t.content,children:[Object(ie.jsx)(he.a,{className:s>0?t.boldPreviewText:t.previewText,children:r}),s>0&&Object(ie.jsx)(he.a,{className:t.notification,children:s})]})]})})},Ue=n(132),Ae=n(256),Re=n(79),Te=n.n(Re),Le=Object(le.a)((function(){return{root:{height:44,marginTop:23,marginLeft:6,display:"flex",alignItems:"center"},subContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",flexGrow:1},username:{letterSpacing:-.23,fontSize:16,fontWeight:"bold",marginLeft:17},ellipsis:{color:"#95A7C4",marginRight:24,opacity:.5}}})),De=Object(u.b)((function(e){return{user:e.user}}),(function(e){return{logout:function(t){e(function(e){return function(){var t=Object(X.a)(Q.a.mark((function t(n){return Q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ee.a.delete("/auth/logout");case 3:n(m({})),re.emit("logout",e),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()}(t)),e({type:G})}}}))((function(e){var t=Le(),n=a.a.useState(null),r=Object(J.a)(n,2),s=r[0],o=r[1],c=e.user||{},i=function(){var t=Object(X.a)(Q.a.mark((function t(){return Q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.logout(e.user.id);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(ie.jsxs)(be.a,{className:t.root,children:[Object(ie.jsx)(Qe,{photoUrl:c.photoUrl,online:!0}),Object(ie.jsxs)(be.a,{className:t.subContainer,children:[Object(ie.jsx)(he.a,{className:t.username,children:c.username}),Object(ie.jsx)(Te.a,{classes:{root:t.ellipsis},onClick:function(e){o(e.currentTarget)}}),Object(ie.jsx)(Ue.a,{id:"simple-menu",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:function(){o(null)},children:Object(ie.jsx)(Ae.a,{onClick:i,children:"Logout"})})]})]})})),Me=n(246),ze=n(248),We=n(128),Be=n.n(We),Pe=function(e){Object(Se.a)(n,e);var t=Object(ke.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).handleSubmit=function(e){e.preventDefault()},e}return Object(ye.a)(n,[{key:"render",value:function(){var e=this.props.classes;return Object(ie.jsx)("form",{onSubmit:this.handleSubmit,children:Object(ie.jsx)(fe.a,{fullWidth:!0,hiddenLabel:!0,children:Object(ie.jsx)(Me.a,{name:"search",onChange:this.props.handleChange,classes:{root:e.filledInput,input:e.input},disableUnderline:!0,placeholder:"Search",startAdornment:Object(ie.jsx)(ze.a,{position:"start",children:Object(ie.jsx)(Be.a,{})})})})})}}]),n}(r.Component),_e=Object(Fe.a)({filledInput:{height:50,background:"#E9EEF9",borderRadius:5,fontSize:13,fontWeight:"bold",color:"#99A9C4",letterSpacing:0,display:"flex",justifyContent:"center",marginBottom:20},input:{"&::placeholder":{color:"#ADC0DE",opacity:1}}})(Pe),Ge=Object(le.a)((function(){return{root:{paddingLeft:21,paddingRight:21,flexGrow:1},title:{fontSize:20,letterSpacing:-.29,fontWeight:"bold",marginTop:32,marginBottom:15}}})),qe=Object(u.b)((function(e){return{conversations:e.conversations}}))((function(e){var t=Ge(),n=e.conversations||[],r=e.handleChange,a=e.searchTerm;return Object(ie.jsxs)(be.a,{className:t.root,children:[Object(ie.jsx)(De,{}),Object(ie.jsx)(he.a,{className:t.title,children:"Chats"}),Object(ie.jsx)(_e,{handleChange:r}),n.filter((function(e){return e.otherUser.username.includes(a)})).map((function(e){return Object(ie.jsx)(Ve,{conversation:e},e.otherUser.username)}))]})})),He=Object(u.b)(null,(function(e){return{searchUsers:function(t){var n;e((n=t,function(){var e=Object(X.a)(Q.a.mark((function e(t){var r,a;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee.a.get("/api/users/".concat(n));case 3:r=e.sent,a=r.data,t({type:R,users:a}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()))},clearSearchedUsers:function(){e({type:T})}}}))((function(e){var t=e.searchUsers,n=e.clearSearchedUsers,a=Object(r.useState)(""),s=Object(J.a)(a,2),o=s[0],c=s[1],i=function(){var e=Object(X.a)(Q.a.mark((function e(r){return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==r.target.value){e.next=4;break}return n(),c(""),e.abrupt("return");case 4:if(!o.includes(r.target.value)){e.next=7;break}return c(r.target.value),e.abrupt("return");case 7:return e.next=9,t(r.target.value);case 9:c(r.target.value);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(ie.jsx)(qe,{handleChange:i,searchTerm:o})})),Ze=function(e){Object(Se.a)(n,e);var t=Object(ke.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).handleClick=function(){var t=Object(X.a)(Q.a.mark((function t(n){var r;return Q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.setActiveChat(n.otherUser.username);case 2:r={recipientId:n.otherUser.id,conversationId:n.id},e.props.conversation.unreadCount>0&&e.props.readMessages(r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(ye.a)(n,[{key:"render",value:function(){var e=this,t=this.props.classes,n=this.props.conversation.otherUser;return Object(ie.jsxs)(be.a,{onClick:function(){return e.handleClick(e.props.conversation)},className:t.root,children:[Object(ie.jsx)(Qe,{photoUrl:n.photoUrl,username:n.username,online:n.online,sidebar:!0}),Object(ie.jsx)(Ne,{conversation:this.props.conversation})]})}}]),n}(r.Component),Ve=Object(u.b)(null,(function(e){return{setActiveChat:function(t){e({type:P,username:t})},readMessages:function(t){var n;e((n=t,function(){var e=Object(X.a)(Q.a.mark((function e(t){var r,a;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee.a.patch("/api/messages/read",n);case 3:r=e.sent,a=r.data,t(W(a)),oe(a),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()))}}}))(Object(Fe.a)({root:{borderRadius:8,height:80,boxShadow:"0 2px 10px 0 rgba(88,133,196,0.05)",marginBottom:10,display:"flex",alignItems:"center","&:hover":{cursor:"grab"}}})(Ze)),Je=n(249),$e=n(257),Ke=Object(le.a)((function(){return{profilePic:{height:44,width:44},badge:{height:13,width:13,borderRadius:"50%",border:"2px solid white",backgroundColor:"#D0DAE9"},online:{backgroundColor:"#1CED84"},sidebar:{marginLeft:17}}})),Qe=function(e){var t=Ke(),n=e.sidebar,r=e.username,a=e.photoUrl,s=e.online;return Object(ie.jsx)(be.a,{className:n?t.sidebar:"",children:Object(ie.jsx)(Je.a,{classes:{badge:"".concat(t.badge," ").concat(s&&t.online)},variant:"dot",anchorOrigin:{horizontal:"right",vertical:"bottom"},overlap:"circle",children:Object(ie.jsx)($e.a,{alt:r,src:a,className:t.profilePic})})})},Xe=Object(le.a)((function(){return{root:{display:"flex",flexDirection:"column",alignItems:"flex-end"},date:{fontSize:11,color:"#BECCE2",fontWeight:"bold",marginBottom:5},text:{fontSize:14,color:"#91A3C0",letterSpacing:-.2,padding:8,fontWeight:"bold"},bubble:{background:"#F4F6FA",borderRadius:"10px 10px 0 10px"},avatar:{height:"20px",width:"20px"}}})),Ye=function(e){var t=Xe(),n=e.time,r=e.text,a=e.isLastRead,s=e.otherUser;return Object(ie.jsxs)(be.a,{className:t.root,children:[Object(ie.jsx)(he.a,{className:t.date,children:n}),Object(ie.jsx)(be.a,{className:t.bubble,children:Object(ie.jsx)(he.a,{className:t.text,children:r})}),a&&Object(ie.jsx)($e.a,{alt:s.username,src:s.photoUrl,className:t.avatar})]})},et=Object(le.a)((function(){return{root:{display:"flex"},avatar:{height:30,width:30,marginRight:11,marginTop:6},usernameDate:{fontSize:11,color:"#BECCE2",fontWeight:"bold",marginBottom:5},bubble:{backgroundImage:"linear-gradient(225deg, #6CC1FF 0%, #3A8DFF 100%)",borderRadius:"0 10px 10px 10px"},text:{fontSize:14,fontWeight:"bold",color:"#FFFFFF",letterSpacing:-.2,padding:8}}})),tt=function(e){var t=et(),n=e.text,r=e.time,a=e.otherUser;return Object(ie.jsxs)(be.a,{className:t.root,children:[Object(ie.jsx)($e.a,{alt:a.username,src:a.photoUrl,className:t.avatar}),Object(ie.jsxs)(be.a,{children:[Object(ie.jsxs)(he.a,{className:t.usernameDate,children:[a.username," ",r]}),Object(ie.jsx)(be.a,{className:t.bubble,children:Object(ie.jsx)(he.a,{className:t.text,children:n})})]})]})},nt=Object(le.a)((function(){return{root:{display:"flex",flexGrow:8,flexDirection:"column"},chatContainer:{marginLeft:41,marginRight:41,display:"flex",flexDirection:"column",flexGrow:1,justifyContent:"space-between"}}})),rt=Object(u.b)((function(e){return{user:e.user,conversation:e.conversations&&e.conversations.find((function(t){return t.otherUser.username===e.activeConversation}))}}),null)((function(e){var t=nt(),n=e.user,r=e.conversation||{};return Object(ie.jsx)(be.a,{className:t.root,children:r.otherUser&&Object(ie.jsxs)(ie.Fragment,{children:[Object(ie.jsx)(ct,{username:r.otherUser.username,online:r.otherUser.online||!1}),Object(ie.jsxs)(be.a,{className:t.chatContainer,children:[Object(ie.jsx)(lt,{messages:r.messages,otherUser:r.otherUser,userId:n.id}),Object(ie.jsx)(st,{otherUser:r.otherUser,conversationId:r.id,user:n})]})]})})})),at=function(e){Object(Se.a)(n,e);var t=Object(ke.a)(n);function n(e){var r;return Object(we.a)(this,n),(r=t.call(this,e)).handleChange=function(e){r.setState({text:e.target.value})},r.handleSubmit=function(){var e=Object(X.a)(Q.a.mark((function e(t){var n;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!t.target.text.value){e.next=6;break}return n={text:t.target.text.value,recipientId:r.props.otherUser.id,conversationId:r.props.conversationId,sender:r.props.conversationId?null:r.props.user},e.next=5,r.props.postMessage(n);case 5:r.setState({text:""});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.state={text:""},r}return Object(ye.a)(n,[{key:"render",value:function(){var e=this.props.classes;return Object(ie.jsx)("form",{className:e.root,onSubmit:this.handleSubmit,children:Object(ie.jsx)(fe.a,{fullWidth:!0,hiddenLabel:!0,children:Object(ie.jsx)(Me.a,{classes:{root:e.input},disableUnderline:!0,placeholder:"Type something...",value:this.state.text,name:"text",onChange:this.handleChange})})})}}]),n}(r.Component),st=Object(u.b)((function(e){return{user:e.user,conversations:e.conversations}}),(function(e){return{postMessage:function(t){var n;e((n=t,function(){var e=Object(X.a)(Q.a.mark((function e(t){var r;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae(n);case 3:r=e.sent,n.conversationId?t(z(r.message)):t((a=n.recipientId,s=r.message,{type:L,payload:{recipientId:a,newMessage:s}})),se(r,n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}var a,s}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()))}}}))(Object(Fe.a)({root:{justifySelf:"flex-end",marginTop:15},input:{height:70,backgroundColor:"#F4F6FA",borderRadius:8,marginBottom:20}})(at)),ot=Object(le.a)((function(e){return{root:{display:"flex",alignItems:"center",justifyContent:"space-between",height:89,marginBottom:34,boxShadow:"0 2px 20px 0 rgba(88,133,196,0.10)"},content:{display:"flex",alignItems:"center",marginLeft:24},username:{fontSize:20,letterSpacing:-.29,fontWeight:"bold",marginRight:14},statusText:{fontSize:12,color:"#BFC9DB",letterSpacing:-.17},statusDot:{height:8,width:8,borderRadius:"50%",marginRight:5,backgroundColor:"#D0DAE9"},online:{background:"#1CED84"},ellipsis:{color:"#95A7C4",marginRight:24,opacity:.5}}})),ct=function(e){var t=ot(),n=e.username,r=e.online;return Object(ie.jsxs)(be.a,{className:t.root,children:[Object(ie.jsxs)(be.a,{className:t.content,children:[Object(ie.jsx)(he.a,{className:t.username,children:n}),Object(ie.jsx)(be.a,{className:"".concat(t.statusDot," ").concat(t[r&&"online"])}),Object(ie.jsx)(he.a,{className:t.statusText,children:r?"Online":"Offline"})]}),Object(ie.jsx)(Te.a,{classes:{root:t.ellipsis}})]})},it=n(129),ut=n.n(it),lt=function(e){var t=e.messages,n=e.otherUser,r=e.userId;return Object(ie.jsx)(be.a,{children:t.map((function(e){var t=ut()(e.createdAt).format("h:mm");return e.senderId===r?Object(ie.jsx)(Ye,{text:e.text,time:t,read:e.read,isLastRead:e.isLastRead,otherUser:n},e.id):Object(ie.jsx)(tt,{text:e.text,time:t,otherUser:n},e.id)}))})},dt=function(e){Object(Se.a)(n,e);var t=Object(ke.a)(n);function n(e){var r;return Object(we.a)(this,n),(r=t.call(this,e)).handleLogout=Object(X.a)(Q.a.mark((function e(){return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.props.logout(r.props.user.id);case 2:case"end":return e.stop()}}),e)}))),r.state={isLoggedIn:!1},r}return Object(ye.a)(n,[{key:"componentDidUpdate",value:function(e){this.props.user.id!==e.user.id&&this.setState({isLoggedIn:!0})}},{key:"componentDidMount",value:function(){this.props.fetchConversations()}},{key:"render",value:function(){var e=this.props.classes;return this.props.user.id?Object(ie.jsx)(ie.Fragment,{children:Object(ie.jsxs)(pe.a,{container:!0,component:"main",className:e.root,children:[Object(ie.jsx)(Ie.a,{}),Object(ie.jsx)(He,{}),Object(ie.jsx)(rt,{})]})}):this.state.isLoggedIn?Object(ie.jsx)($.a,{to:"/login"}):Object(ie.jsx)($.a,{to:"/register"})}}]),n}(r.Component),pt=Object(u.b)((function(e){return{user:e.user,conversations:e.conversations}}),(function(e){return{fetchConversations:function(){e(function(){var e=Object(X.a)(Q.a.mark((function e(t){var n,r;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee.a.get("/api/conversations");case 3:n=e.sent,r=n.data,t({type:E,conversations:r}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}())}}}))(Object(Fe.a)({root:{height:"97vh"}})(dt)),ht=n(255),bt=n(130),jt=n.n(bt),ft=Object(le.a)((function(e){return{snackbar:{backgroundColor:"red",fontWeight:"bold"},icon:{color:"white"}}})),mt=function(e){var t=ft();return Object(ie.jsx)(ht.a,{open:e.snackBarOpen,onClose:function(){return e.setSnackBarOpen(!1)},message:e.errorMessage||"Sorry, an error occured. Please try again",action:Object(ie.jsx)(a.a.Fragment,{children:Object(ie.jsx)(je.a,{className:t.icon,size:"small",onClick:function(){return e.setSnackBarOpen(!1)},children:Object(ie.jsx)(jt.a,{color:"secondary"})})}),ContentProps:{classes:{root:t.snackbar}}})},gt=Object($.h)(Object(u.b)((function(e){return{user:e.user}}),(function(e){return{fetchUser:function(){e(function(){var e=Object(X.a)(Q.a.mark((function e(t){var n,r;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(g(!0)),e.prev=1,e.next=4,ee.a.get("/auth/user");case 4:n=e.sent,r=n.data,t(m(r)),r.id&&re.emit("go-online",r.id),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0);case 13:return e.prev=13,t(g(!1)),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])})));return function(t){return e.apply(this,arguments)}}())}}}))((function(e){var t=e.user,n=e.fetchUser,a=Object(r.useState)(""),s=Object(J.a)(a,2),o=s[0],c=s[1],i=Object(r.useState)(!1),u=Object(J.a)(i,2),l=u[0],d=u[1];return Object(r.useEffect)((function(){n()}),[n]),Object(r.useEffect)((function(){t.error&&("string"===typeof t.error?c(t.error):c("Internal Server Error. Please try again"),d(!0))}),[t.error]),e.user.isFetchingUser?Object(ie.jsx)("div",{children:"Loading..."}):Object(ie.jsxs)(ie.Fragment,{children:[l&&Object(ie.jsx)(mt,{setSnackBarOpen:d,errorMessage:o,snackBarOpen:l}),Object(ie.jsxs)($.d,{children:[Object(ie.jsx)($.b,{path:"/login",component:Ce}),Object(ie.jsx)($.b,{path:"/register",component:ve}),Object(ie.jsx)($.b,{exact:!0,path:"/",render:function(e){var t;return(null===(t=e.user)||void 0===t?void 0:t.id)?Object(ie.jsx)(pt,{}):Object(ie.jsx)(ve,{})}}),Object(ie.jsx)($.b,{path:"/home",component:pt})]})]})})));var xt=function(){return Object(ie.jsx)(u.a,{store:H,children:Object(ie.jsx)(c.a,{theme:V,children:Object(ie.jsx)(i.a,{children:Object(ie.jsx)(gt,{})})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(ie.jsx)(xt,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[208,1,2]]]);
//# sourceMappingURL=main.adeaeb8b.chunk.js.map